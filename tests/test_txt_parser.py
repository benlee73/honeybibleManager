from app.txt_parser import extract_chat_meta, parse_txt


class TestParseTxt:
    def test_ì‚¬ìš©ì_ë©”ì‹œì§€_íŒŒì‹±(self):
        text = "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/2ğŸ·")

    def test_ì‹œìŠ¤í…œ_ë©”ì‹œì§€_ìŠ¤í‚µ(self):
        text = (
            "2026. 2. 1. ì˜¤í›„ 8:26: í™ê¸¸ë™ë‹˜ì´ ê¹€ì² ìˆ˜ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0][0] == "í™ê¸¸ë™"

    def test_ë‚ ì§œ_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "2026ë…„ 2ì›” 1ì¼ ì¼ìš”ì¼\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1

    def test_íŒŒì¼_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "Talk_2026.2.10 08:50-1.txt\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤í›„ 12:16\r\n"
            "\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/2ğŸ·")

    def test_ë©€í‹°ë¼ì¸_ë©”ì‹œì§€(self):
        text = (
            "2026. 2. 1. ì˜¤í›„ 8:29, í™ê¸¸ë™ : ì²«ì¤„\r\n"
            "ë‘˜ì§¸ì¤„\r\n"
            "ì…‹ì§¸ì¤„\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, ê¹€ì² ìˆ˜ : ë‹¨ì¼ì¤„\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 2
        assert rows[0] == ("í™ê¸¸ë™", "ì²«ì¤„\në‘˜ì§¸ì¤„\nì…‹ì§¸ì¤„")
        assert rows[1] == ("ê¹€ì² ìˆ˜", "ë‹¨ì¼ì¤„")

    def test_ë¹ˆ_ì…ë ¥(self):
        assert parse_txt("") == []

    def test_ì‹œìŠ¤í…œ_ë©”ì‹œì§€ë§Œ_ìˆëŠ”_ì…ë ¥(self):
        text = "2026. 2. 1. ì˜¤í›„ 8:26: í™ê¸¸ë™ë‹˜ì´ ë°©ì¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.\r\n"
        assert parse_txt(text) == []

    def test_ì—¬ëŸ¬_ì‚¬ìš©ì_ë©”ì‹œì§€(self):
        text = (
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
            "2026. 2. 2. ì˜¤ì „ 8:00, ê¹€ì² ìˆ˜ : 2/2ğŸ¦Š\r\n"
            "2026. 2. 2. ì˜¤í›„ 9:00, ì´ì˜í¬ : 2/2â„ï¸\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 3
        assert rows[0][0] == "í™ê¸¸ë™"
        assert rows[1][0] == "ê¹€ì² ìˆ˜"
        assert rows[2][0] == "ì´ì˜í¬"

    def test_ê³µë°±ì´ë¦„_ì‚¬ìš©ì(self):
        text = "2026. 2. 2. ì˜¤ì „ 7:33, ê´‘ì²œ ìœ ì˜í›ˆ : 2/2ğŸ½\r\n"
        rows = parse_txt(text)
        assert rows[0] == ("ê´‘ì²œ ìœ ì˜í›ˆ", "2/2ğŸ½")

    def test_ë©€í‹°ë¼ì¸_í›„_ì‹œìŠ¤í…œ_ë©”ì‹œì§€(self):
        text = (
            "2026. 2. 1. ì˜¤í›„ 8:29, í™ê¸¸ë™ : ì²«ì¤„\r\n"
            "ë‘˜ì§¸ì¤„\r\n"
            "2026. 2. 1. ì˜¤í›„ 8:30: ì‹œìŠ¤í…œ ë©”ì‹œì§€ì…ë‹ˆë‹¤.\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "ì²«ì¤„\në‘˜ì§¸ì¤„")

    def test_ì¢…í•©_ì‹œë‚˜ë¦¬ì˜¤(self):
        text = (
            "Talk_2026.2.10 08:50-1.txt\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤í›„ 12:16\r\n"
            "\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì¼ìš”ì¼\r\n"
            "2026. 2. 1. ì˜¤í›„ 8:26: í™ê¸¸ë™ë‹˜ì´ ë°©ì¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.\r\n"
            "2026. 2. 1. ì˜¤í›„ 8:29, í™ê¸¸ë™ : ê³µì§€ì‚¬í•­\r\n"
            "ì—¬ëŸ¬ ì¤„ ì•ˆë‚´ë¬¸\r\n"
            "\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì›”ìš”ì¼\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, ê¹€ì² ìˆ˜ : 2/2ğŸ·\r\n"
            "2026. 2. 2. ì˜¤ì „ 8:00, ì´ì˜í¬ : 2/2ğŸ¦Š\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 3
        assert rows[0] == ("í™ê¸¸ë™", "ê³µì§€ì‚¬í•­\nì—¬ëŸ¬ ì¤„ ì•ˆë‚´ë¬¸")
        assert rows[1] == ("ê¹€ì² ìˆ˜", "2/2ğŸ·")
        assert rows[2] == ("ì´ì˜í¬", "2/2ğŸ¦Š")

    def test_LF_ì¤„ë°”ê¿ˆ_ì²˜ë¦¬(self):
        text = "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\n"
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/2ğŸ·")

    def test_ì‚¬ì§„_ë©”ì‹œì§€(self):
        text = "2026. 2. 1. ì˜¤í›„ 8:37, í™ê¸¸ë™ : ì‚¬ì§„\r\n"
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "ì‚¬ì§„")

    def test_24ì‹œê°„ì œ_ì‚¬ìš©ì_ë©”ì‹œì§€_íŒŒì‹±(self):
        text = "2026. 2. 1. 20:21, í™ê¸¸ë™ : 2/1ğŸ·\r\n"
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/1ğŸ·")

    def test_24ì‹œê°„ì œ_ì‹œìŠ¤í…œ_ë©”ì‹œì§€_ìŠ¤í‚µ(self):
        text = (
            "2026. 2. 1. 20:21: í™ê¸¸ë™ë‹˜ì´ ê¹€ì² ìˆ˜ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "2026. 2. 1. 20:22, í™ê¸¸ë™ : 2/1ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0][0] == "í™ê¸¸ë™"

    def test_24ì‹œê°„ì œ_ì—¬ëŸ¬_ì‚¬ìš©ì_ë©”ì‹œì§€(self):
        text = (
            "2026. 2. 2. 07:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
            "2026. 2. 2. 08:00, ê¹€ì² ìˆ˜ : 2/2ğŸ¦Š\r\n"
            "2026. 2. 2. 21:00, ì´ì˜í¬ : 2/2â„ï¸\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 3
        assert rows[0][0] == "í™ê¸¸ë™"
        assert rows[1][0] == "ê¹€ì² ìˆ˜"
        assert rows[2][0] == "ì´ì˜í¬"


class TestExtractChatMeta:
    def test_ì •ìƒ_í—¤ë”__ë°©ì´ë¦„_ë°_ë‚ ì§œ_ì¶”ì¶œ(self):
        text = (
            "ê¿€ì„±ê²½ - êµìœ¡êµ­ ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 9. ì˜¤ì „ 10:50\r\n"
            "\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì¼ìš”ì¼\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] == "ê¿€ì„±ê²½ - êµìœ¡êµ­"
        assert meta["saved_date"] == "2026/02/09-10:50"

    def test_ì˜¤í›„_ì‹œê°„__12ì‹œê°„_ë³€í™˜(self):
        text = (
            "í…ŒìŠ¤íŠ¸ë°© ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤í›„ 3:30\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] == "í…ŒìŠ¤íŠ¸ë°©"
        assert meta["saved_date"] == "2026/02/10-15:30"

    def test_ì˜¤í›„_12ì‹œ__12ìœ ì§€(self):
        text = (
            "í…ŒìŠ¤íŠ¸ë°© ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤í›„ 12:05\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["saved_date"] == "2026/02/10-12:05"

    def test_ì˜¤ì „_12ì‹œ__0ì‹œ_ë³€í™˜(self):
        text = (
            "í…ŒìŠ¤íŠ¸ë°© ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤ì „ 12:30\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["saved_date"] == "2026/02/10-00:30"

    def test_24ì‹œê°„ì œ_ì €ì¥ë‚ ì§œ_ì¶”ì¶œ(self):
        text = (
            "ê¿€ì„±ê²½ ë°© ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 3. 1. 08:11\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["saved_date"] == "2026/03/01-08:11"

    def test_í—¤ë”_ì—†ëŠ”_í…ìŠ¤íŠ¸__None_ë°˜í™˜(self):
        text = "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        meta = extract_chat_meta(text)
        assert meta["room_name"] is None
        assert meta["saved_date"] is None

    def test_ë¹ˆ_í…ìŠ¤íŠ¸__None_ë°˜í™˜(self):
        meta = extract_chat_meta("")
        assert meta["room_name"] is None
        assert meta["saved_date"] is None

    def test_Talk_í—¤ë”_í¬í•¨__ë°©ì´ë¦„_ì¶”ì¶œ(self):
        text = (
            "Talk_2026.2.10 08:50-1.txt\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤í›„ 12:16\r\n"
            "ê¿€ì„±ê²½ - êµìœ¡êµ­ ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] == "ê¿€ì„±ê²½ - êµìœ¡êµ­"
        assert meta["saved_date"] == "2026/02/10-12:16"


class TestParseTxtGalaxy:
    def test_ê°¤ëŸ­ì‹œ_ì‚¬ìš©ì_ë©”ì‹œì§€_íŒŒì‹±(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 7:52, ê¹€íƒœí™˜ : 2/2ğŸ‰\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("ê¹€íƒœí™˜", "2/2ğŸ‰")

    def test_ê°¤ëŸ­ì‹œ_ì‹œìŠ¤í…œ_ë©”ì‹œì§€_ìŠ¤í‚µ(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì˜¤í›„ 8:24, ê¹€íƒœí™˜ë‹˜ì´ í™ê¸¸ë™ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 7:52, ê¹€íƒœí™˜ : 2/2ğŸ‰\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0][0] == "ê¹€íƒœí™˜"

    def test_ê°¤ëŸ­ì‹œ_ë‚ ì§œ_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì˜¤í›„ 8:24\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 7:52, ê¹€íƒœí™˜ : 2/2ğŸ‰\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1

    def test_ê°¤ëŸ­ì‹œ_ë©€í‹°ë¼ì¸_ë©”ì‹œì§€(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì˜¤í›„ 8:25, ê¹€íƒœí™˜ : ì²«ì¤„\r\n"
            "ë‘˜ì§¸ì¤„\r\n"
            "ì…‹ì§¸ì¤„\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 7:52, í™ê¸¸ë™ : ë‹¨ì¼ì¤„\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 2
        assert rows[0] == ("ê¹€íƒœí™˜", "ì²«ì¤„\në‘˜ì§¸ì¤„\nì…‹ì§¸ì¤„")
        assert rows[1] == ("í™ê¸¸ë™", "ë‹¨ì¼ì¤„")

    def test_ê°¤ëŸ­ì‹œ_ì‚­ì œ_ë©”ì‹œì§€_ì²˜ë¦¬(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 8:29, ì¶”ì°¬ë¯¸ : 2/2 ğŸŒˆ\r\n"
            "ë©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 9:39, ì´ì‹œí˜„ : 2/2ğŸŠ\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 2
        # ì‚­ì œ ë©”ì‹œì§€ëŠ” íƒ€ì„ìŠ¤íƒ¬í”„ ì—†ì–´ ì´ì „ ì‚¬ìš©ìì˜ ë©€í‹°ë¼ì¸ìœ¼ë¡œ ì—°ê²°ë¨
        assert rows[0] == ("ì¶”ì°¬ë¯¸", "2/2 ğŸŒˆ\në©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
        assert rows[1] == ("ì´ì‹œí˜„", "2/2ğŸŠ")

    def test_ê°¤ëŸ­ì‹œ_ì¢…í•©_ì‹œë‚˜ë¦¬ì˜¤(self):
        text = (
            "ğŸš©2026 ì„±ê²½ì¼ë… PART 1 16 ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
            "\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì˜¤í›„ 8:24\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì˜¤í›„ 8:24, ê¹€íƒœí™˜ë‹˜ì´ í™ê¸¸ë™ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì˜¤í›„ 8:24, ê¹€íƒœí™˜ : ì•ˆë…•í•˜ì„¸ìš”\r\n"
            "ì„±ê²½ ì½ê¸° ë°©ì…ë‹ˆë‹¤~!\r\n"
            "\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 7:52\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 7:52, ê¹€íƒœí™˜ : 2/2ğŸ‰\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 8:28, í™©ì§€ìš´ : 2/2 ğŸ¦­\r\n"
            "ë©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì˜¤ì „ 9:39, ì´ì‹œí˜„ : 2/2ğŸŠ\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 4
        assert rows[0] == ("ê¹€íƒœí™˜", "ì•ˆë…•í•˜ì„¸ìš”\nì„±ê²½ ì½ê¸° ë°©ì…ë‹ˆë‹¤~!")
        assert rows[1] == ("ê¹€íƒœí™˜", "2/2ğŸ‰")
        assert rows[2] == ("í™©ì§€ìš´", "2/2 ğŸ¦­\në©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
        assert rows[3] == ("ì´ì‹œí˜„", "2/2ğŸŠ")


class TestExtractChatMetaGalaxy:
    def test_ê°¤ëŸ­ì‹œ_ë°©ì´ë¦„_ë°_ì €ì¥ë‚ ì§œ_ì¶”ì¶œ(self):
        text = (
            "ğŸš©2026 ì„±ê²½ì¼ë… PART 1 16 ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] == "ğŸš©2026 ì„±ê²½ì¼ë… PART 1 16"
        assert meta["saved_date"] == "2026/02/09-18:35"

    def test_ê°¤ëŸ­ì‹œ_ì˜¤í›„_ì‹œê°„_ë³€í™˜(self):
        text = (
            "í…ŒìŠ¤íŠ¸ë°© ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 10ì¼ ì˜¤í›„ 3:30\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] == "í…ŒìŠ¤íŠ¸ë°©"
        assert meta["saved_date"] == "2026/02/10-15:30"

    def test_ê°¤ëŸ­ì‹œ_ì˜¤í›„_12ì‹œ_ìœ ì§€(self):
        text = (
            "í…ŒìŠ¤íŠ¸ë°© ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 10ì¼ ì˜¤í›„ 12:05\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["saved_date"] == "2026/02/10-12:05"

    def test_ê°¤ëŸ­ì‹œ_ì˜¤ì „_12ì‹œ_0ì‹œ_ë³€í™˜(self):
        text = (
            "í…ŒìŠ¤íŠ¸ë°© ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 1ì›” 1ì¼ ì˜¤ì „ 12:30\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["saved_date"] == "2026/01/01-00:30"

    def test_ê°¤ëŸ­ì‹œ_ë°©ì´ë¦„_ì—†ìŒ__None_ë°˜í™˜(self):
        text = "ì €ì¥í•œ ë‚ ì§œ : 2026ë…„ 2ì›” 9ì¼ ì˜¤í›„ 6:35\r\n"
        meta = extract_chat_meta(text)
        assert meta["room_name"] is None
        assert meta["saved_date"] == "2026/02/09-18:35"


class TestParseTxtWindows:
    def test_ìœˆë„ìš°_ì‚¬ìš©ì_ë©”ì‹œì§€_íŒŒì‹±(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
            "[ê¹€ì˜ˆìŠ¬] [ì˜¤í›„ 8:35] ì•ˆë…•í•˜ì„¸ìš”!\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("ê¹€ì˜ˆìŠ¬", "ì•ˆë…•í•˜ì„¸ìš”!")

    def test_ìœˆë„ìš°_ì‹œìŠ¤í…œ_ë©”ì‹œì§€_ìŠ¤í‚µ(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
            "ê¹€ì˜ˆìŠ¬ë‹˜ì´ í™ê¸¸ë™ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "[ê¹€ì˜ˆìŠ¬] [ì˜¤í›„ 8:35] ì•ˆë…•í•˜ì„¸ìš”!\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0][0] == "ê¹€ì˜ˆìŠ¬"

    def test_ìœˆë„ìš°_ë‚ ì§œ_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
            "--------------- 2026ë…„ 2ì›” 1ì¼ ì¼ìš”ì¼ ---------------\r\n"
            "[ê¹€ì˜ˆìŠ¬] [ì˜¤í›„ 8:35] 2/1ğŸ¬\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1

    def test_ìœˆë„ìš°_ë©€í‹°ë¼ì¸_ë©”ì‹œì§€(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
            "[ê¹€ì˜ˆìŠ¬] [ì˜¤í›„ 8:38] ì²«ì¤„\r\n"
            "ë‘˜ì§¸ì¤„\r\n"
            "ì…‹ì§¸ì¤„\r\n"
            "[í™ê¸¸ë™] [ì˜¤ì „ 7:52] ë‹¨ì¼ì¤„\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 2
        assert rows[0] == ("ê¹€ì˜ˆìŠ¬", "ì²«ì¤„\në‘˜ì§¸ì¤„\nì…‹ì§¸ì¤„")
        assert rows[1] == ("í™ê¸¸ë™", "ë‹¨ì¼ì¤„")

    def test_ìœˆë„ìš°_ì´ëª¨ì§€_ì‚¬ìš©ìëª…(self):
        text = (
            "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
            "[ğŸ¯ ê¹€ì‹ ì˜ 99 ğŸ¦„] [ì˜¤ì „ 8:44] ê¹€ì‹ ì˜ ğŸ¡\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("ğŸ¯ ê¹€ì‹ ì˜ 99 ğŸ¦„", "ê¹€ì‹ ì˜ ğŸ¡")

    def test_ìœˆë„ìš°_ì¢…í•©_ì‹œë‚˜ë¦¬ì˜¤(self):
        text = (
            "ğŸ“–26 ì„±ê²½ì¼ë… PART1ğŸ™ğŸ» ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
            "\r\n"
            "--------------- 2026ë…„ 2ì›” 1ì¼ ì¼ìš”ì¼ ---------------\r\n"
            "ê¹€ì˜ˆìŠ¬ë‹˜ì´ í™ê¸¸ë™ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "ê¹€ì˜ˆìŠ¬ë‹˜ì´ ë°©ì¥ì´ ë˜ì–´ íŒ€ì±„íŒ…ì„ ì‹œì‘í–ˆì–´ìš”!\r\n"
            "[ê¹€ì˜ˆìŠ¬] [ì˜¤í›„ 8:35] ì•ˆë…•í•˜ì„¸ìš”!\r\n"
            "ì„±ê²½ ì½ê¸° ë°©ì…ë‹ˆë‹¤~!\r\n"
            "\r\n"
            "--------------- 2026ë…„ 2ì›” 2ì¼ ì›”ìš”ì¼ ---------------\r\n"
            "[ê¹€ì˜ˆìŠ¬] [ì˜¤ì „ 7:53] ğŸ—“ï¸ 2/2 ì°½ì„¸ê¸° 1-4\r\n"
            "[ğŸ¯ ì´ìƒí˜¸ 99] [ì˜¤ì „ 8:06] 2/2 ğŸµ\r\n"
            "[ğŸ¯ ê¹€ì‹ ì˜ 99 ğŸ¦„] [ì˜¤ì „ 8:11] 2/2 ğŸ¡\r\n"
            "ê¹€ì˜ˆìŠ¬ë‹˜ì´ ì´ì†”ì§€ 96ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "[ì •ì£¼í¬] [ì˜¤í›„ 9:24] 2/2ğŸ“\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 5
        assert rows[0] == ("ê¹€ì˜ˆìŠ¬", "ì•ˆë…•í•˜ì„¸ìš”!\nì„±ê²½ ì½ê¸° ë°©ì…ë‹ˆë‹¤~!")
        assert rows[1] == ("ê¹€ì˜ˆìŠ¬", "ğŸ—“ï¸ 2/2 ì°½ì„¸ê¸° 1-4")
        assert rows[2] == ("ğŸ¯ ì´ìƒí˜¸ 99", "2/2 ğŸµ")
        # ì‹œìŠ¤í…œ ë©”ì‹œì§€ê°€ ì´ì „ ì‚¬ìš©ì ë©”ì‹œì§€ì˜ ë©€í‹°ë¼ì¸ìœ¼ë¡œ ì—°ê²°ë¨
        assert rows[3] == (
            "ğŸ¯ ê¹€ì‹ ì˜ 99 ğŸ¦„",
            "2/2 ğŸ¡\nê¹€ì˜ˆìŠ¬ë‹˜ì´ ì´ì†”ì§€ 96ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.",
        )
        assert rows[4] == ("ì •ì£¼í¬", "2/2ğŸ“")


class TestExtractChatMetaWindows:
    def test_ìœˆë„ìš°_ë°©ì´ë¦„_ë°_ISO_ì €ì¥ë‚ ì§œ_ì¶”ì¶œ(self):
        text = (
            "ğŸ“–26 ì„±ê²½ì¼ë… PART1ğŸ™ğŸ» ë‹˜ê³¼ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] == "ğŸ“–26 ì„±ê²½ì¼ë… PART1ğŸ™ğŸ»"
        assert meta["saved_date"] == "2026/02/14-14:09"

    def test_ìœˆë„ìš°_ë°©ì´ë¦„_ì—†ìŒ__None_ë°˜í™˜(self):
        text = "ì €ì¥í•œ ë‚ ì§œ : 2026-02-14 14:09:18\r\n"
        meta = extract_chat_meta(text)
        assert meta["room_name"] is None
        assert meta["saved_date"] == "2026/02/14-14:09"


class TestParseTxtEnglish:
    def test_ì˜ë¬¸_ì‚¬ìš©ì_ë©”ì‹œì§€_íŒŒì‹±(self):
        text = (
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "Feb 1, 2026 at 20:35, ê¹€ì˜ˆìŠ¬ : 2/1ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("ê¹€ì˜ˆìŠ¬", "2/1ğŸ·")

    def test_ì˜ë¬¸_ì‹œìŠ¤í…œ_ë©”ì‹œì§€_ìŠ¤í‚µ(self):
        text = (
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "Feb 1, 2026 at 20:29: í™ê¸¸ë™ invited ê¹€ì² ìˆ˜.\r\n"
            "Feb 1, 2026 at 20:35, ê¹€ì˜ˆìŠ¬ : 2/1ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0][0] == "ê¹€ì˜ˆìŠ¬"

    def test_ì˜ë¬¸_ë‚ ì§œ_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "Sunday, February 1, 2026\r\n"
            "Feb 2, 2026 at 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1

    def test_ì˜ë¬¸_íŒŒì¼_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "Talk_2026.2.13 18:42-1.txt\r\n"
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "\r\n"
            "Feb 2, 2026 at 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/2ğŸ·")

    def test_ì˜ë¬¸_ë©€í‹°ë¼ì¸_ë©”ì‹œì§€(self):
        text = (
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "Feb 1, 2026 at 20:29, í™ê¸¸ë™ : ì²«ì¤„\r\n"
            "ë‘˜ì§¸ì¤„\r\n"
            "ì…‹ì§¸ì¤„\r\n"
            "Feb 2, 2026 at 7:33, ê¹€ì² ìˆ˜ : ë‹¨ì¼ì¤„\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 2
        assert rows[0] == ("í™ê¸¸ë™", "ì²«ì¤„\në‘˜ì§¸ì¤„\nì…‹ì§¸ì¤„")
        assert rows[1] == ("ê¹€ì² ìˆ˜", "ë‹¨ì¼ì¤„")

    def test_ì˜ë¬¸_ì¢…í•©_ì‹œë‚˜ë¦¬ì˜¤(self):
        text = (
            "Talk_2026.2.13 18:42-1.txt\r\n"
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "\r\n"
            "Sunday, February 1, 2026\r\n"
            "Feb 1, 2026 at 20:26: í™ê¸¸ë™ë‹˜ì´ ë°©ì¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.\r\n"
            "Feb 1, 2026 at 20:29, í™ê¸¸ë™ : ê³µì§€ì‚¬í•­\r\n"
            "ì—¬ëŸ¬ ì¤„ ì•ˆë‚´ë¬¸\r\n"
            "\r\n"
            "Monday, February 2, 2026\r\n"
            "Feb 2, 2026 at 7:33, ê¹€ì² ìˆ˜ : 2/2ğŸ·\r\n"
            "Feb 2, 2026 at 8:00, ì´ì˜í¬ : 2/2ğŸ¦Š\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 3
        assert rows[0] == ("í™ê¸¸ë™", "ê³µì§€ì‚¬í•­\nì—¬ëŸ¬ ì¤„ ì•ˆë‚´ë¬¸")
        assert rows[1] == ("ê¹€ì² ìˆ˜", "2/2ğŸ·")
        assert rows[2] == ("ì´ì˜í¬", "2/2ğŸ¦Š")


class TestExtractChatMetaEnglish:
    def test_ì˜ë¬¸_ì €ì¥ë‚ ì§œ_ì¶”ì¶œ(self):
        text = (
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "\r\n"
            "Sunday, February 1, 2026\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] is None
        assert meta["saved_date"] == "2026/02/13-18:42"

    def test_ì˜ë¬¸_ë°©ì´ë¦„_ì—†ìŒ__None_ë°˜í™˜(self):
        text = (
            "Date Saved : Feb 13, 2026 at 18:42\r\n"
            "Feb 1, 2026 at 20:35, ê¹€ì˜ˆìŠ¬ : ë©”ì‹œì§€\r\n"
        )
        meta = extract_chat_meta(text)
        assert meta["room_name"] is None

    def test_ì˜ë¬¸_ì˜¤ì „ì‹œê°„_ì¶”ì¶œ(self):
        text = "Date Saved : Jan 5, 2026 at 9:05\r\n"
        meta = extract_chat_meta(text)
        assert meta["saved_date"] == "2026/01/05-09:05"

    def test_ì˜ë¬¸_12ì›”_ì¶”ì¶œ(self):
        text = "Date Saved : Dec 25, 2025 at 0:00\r\n"
        meta = extract_chat_meta(text)
        assert meta["saved_date"] == "2025/12/25-00:00"
