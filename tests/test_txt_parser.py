from app.txt_parser import parse_txt


class TestParseTxt:
    def test_ì‚¬ìš©ì_ë©”ì‹œì§€_íŒŒì‹±(self):
        text = "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/2ğŸ·")

    def test_ì‹œìŠ¤í…œ_ë©”ì‹œì§€_ìŠ¤í‚µ(self):
        text = (
            "2026. 2. 1. ì˜¤í›„ 8:26: í™ê¸¸ë™ë‹˜ì´ ê¹€ì² ìˆ˜ë‹˜ì„ ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤.\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0][0] == "í™ê¸¸ë™"

    def test_ë‚ ì§œ_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "2026ë…„ 2ì›” 1ì¼ ì¼ìš”ì¼\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1

    def test_íŒŒì¼_í—¤ë”_ìŠ¤í‚µ(self):
        text = (
            "Talk_2026.2.10 08:50-1.txt\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤í›„ 12:16\r\n"
            "\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/2ğŸ·")

    def test_ë©€í‹°ë¼ì¸_ë©”ì‹œì§€(self):
        text = (
            "2026. 2. 1. ì˜¤í›„ 8:29, í™ê¸¸ë™ : ì²«ì¤„\r\n"
            "ë‘˜ì§¸ì¤„\r\n"
            "ì…‹ì§¸ì¤„\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, ê¹€ì² ìˆ˜ : ë‹¨ì¼ì¤„\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 2
        assert rows[0] == ("í™ê¸¸ë™", "ì²«ì¤„\në‘˜ì§¸ì¤„\nì…‹ì§¸ì¤„")
        assert rows[1] == ("ê¹€ì² ìˆ˜", "ë‹¨ì¼ì¤„")

    def test_ë¹ˆ_ì…ë ¥(self):
        assert parse_txt("") == []

    def test_ì‹œìŠ¤í…œ_ë©”ì‹œì§€ë§Œ_ìˆëŠ”_ì…ë ¥(self):
        text = "2026. 2. 1. ì˜¤í›„ 8:26: í™ê¸¸ë™ë‹˜ì´ ë°©ì¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.\r\n"
        assert parse_txt(text) == []

    def test_ì—¬ëŸ¬_ì‚¬ìš©ì_ë©”ì‹œì§€(self):
        text = (
            "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\r\n"
            "2026. 2. 2. ì˜¤ì „ 8:00, ê¹€ì² ìˆ˜ : 2/2ğŸ¦Š\r\n"
            "2026. 2. 2. ì˜¤í›„ 9:00, ì´ì˜í¬ : 2/2â„ï¸\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 3
        assert rows[0][0] == "í™ê¸¸ë™"
        assert rows[1][0] == "ê¹€ì² ìˆ˜"
        assert rows[2][0] == "ì´ì˜í¬"

    def test_ê³µë°±ì´ë¦„_ì‚¬ìš©ì(self):
        text = "2026. 2. 2. ì˜¤ì „ 7:33, ê´‘ì²œ ìœ ì˜í›ˆ : 2/2ğŸ½\r\n"
        rows = parse_txt(text)
        assert rows[0] == ("ê´‘ì²œ ìœ ì˜í›ˆ", "2/2ğŸ½")

    def test_ë©€í‹°ë¼ì¸_í›„_ì‹œìŠ¤í…œ_ë©”ì‹œì§€(self):
        text = (
            "2026. 2. 1. ì˜¤í›„ 8:29, í™ê¸¸ë™ : ì²«ì¤„\r\n"
            "ë‘˜ì§¸ì¤„\r\n"
            "2026. 2. 1. ì˜¤í›„ 8:30: ì‹œìŠ¤í…œ ë©”ì‹œì§€ì…ë‹ˆë‹¤.\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "ì²«ì¤„\në‘˜ì§¸ì¤„")

    def test_ì¢…í•©_ì‹œë‚˜ë¦¬ì˜¤(self):
        text = (
            "Talk_2026.2.10 08:50-1.txt\r\n"
            "ì €ì¥í•œ ë‚ ì§œ : 2026. 2. 10. ì˜¤í›„ 12:16\r\n"
            "\r\n"
            "2026ë…„ 2ì›” 1ì¼ ì¼ìš”ì¼\r\n"
            "2026. 2. 1. ì˜¤í›„ 8:26: í™ê¸¸ë™ë‹˜ì´ ë°©ì¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.\r\n"
            "2026. 2. 1. ì˜¤í›„ 8:29, í™ê¸¸ë™ : ê³µì§€ì‚¬í•­\r\n"
            "ì—¬ëŸ¬ ì¤„ ì•ˆë‚´ë¬¸\r\n"
            "\r\n"
            "2026ë…„ 2ì›” 2ì¼ ì›”ìš”ì¼\r\n"
            "2026. 2. 2. ì˜¤ì „ 7:33, ê¹€ì² ìˆ˜ : 2/2ğŸ·\r\n"
            "2026. 2. 2. ì˜¤ì „ 8:00, ì´ì˜í¬ : 2/2ğŸ¦Š\r\n"
        )
        rows = parse_txt(text)
        assert len(rows) == 3
        assert rows[0] == ("í™ê¸¸ë™", "ê³µì§€ì‚¬í•­\nì—¬ëŸ¬ ì¤„ ì•ˆë‚´ë¬¸")
        assert rows[1] == ("ê¹€ì² ìˆ˜", "2/2ğŸ·")
        assert rows[2] == ("ì´ì˜í¬", "2/2ğŸ¦Š")

    def test_LF_ì¤„ë°”ê¿ˆ_ì²˜ë¦¬(self):
        text = "2026. 2. 2. ì˜¤ì „ 7:33, í™ê¸¸ë™ : 2/2ğŸ·\n"
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "2/2ğŸ·")

    def test_ì‚¬ì§„_ë©”ì‹œì§€(self):
        text = "2026. 2. 1. ì˜¤í›„ 8:37, í™ê¸¸ë™ : ì‚¬ì§„\r\n"
        rows = parse_txt(text)
        assert len(rows) == 1
        assert rows[0] == ("í™ê¸¸ë™", "ì‚¬ì§„")
